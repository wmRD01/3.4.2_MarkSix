{"version":3,"sources":["file:///C:/CocosProject/3.4.2_MarkSix/assets/Script/Contorll/AutoView/testauto.ts"],"names":["_decorator","view","ResolutionPolicy","find","UITransform","screen","macro","size","sys","game","DelayTime","ccclass","property","testAuto","SetConfigAdjustView","type","delayTime","os","OS","ANDROID","jsb","reflection","callStaticMethod","adjustFunction","AdjustViewPortrait","AdjustViewLandscape","window","addEventListener","isCanUpdata","getInstance","StartDT_NotClear","console","error","emit","canvasSize","getWinSize","curDR","getDesignResolutionSize","cvs","getComponent","width","height","setDesignResolutionSize","FIXED_HEIGHT","FIXED_WIDTH","AdjustView","windowSize","checkWindowOrientation","ORIENTATION_LANDSCAPE","setOrientation","ORIENTATION_PORTRAIT","innerWidth","innerHeight"],"mappings":"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","sourcesContent":["\r\nimport { _decorator, view, ResolutionPolicy, find, UITransform, screen, Size, macro, size, sys, game, } from 'cc';\r\nimport DelayTime from '../../../Plug/DelayTime';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('testAuto')\r\nexport default class testAuto {\r\n    static curDR: Size = null;\r\n    static isCanUpdata: boolean = true\r\n    static adjustFunction: Function;\r\n\r\n    /**\r\n     * \r\n     * @param type as macro ORIENTATION;\r\n     * @param 1 = Portrait;\r\n     * @param 2 = LANDSCAPE;\r\n     * @param 3 = Auto(暫時用不到?);\r\n     */\r\n    static SetConfigAdjustView(type: number, delayTime: number) {\r\n        switch (type) {\r\n            case 1:\r\n                if (sys.os == sys.OS.ANDROID)\r\n                    jsb.reflection.callStaticMethod('com.cocos.game/AppActivity', 'setOrientation', '(Ljava/lang/String;)V', \"V\")\r\n                this.adjustFunction = this.AdjustViewPortrait;\r\n                break;\r\n            case 2:\r\n                if (sys.os == sys.OS.ANDROID)\r\n                    jsb.reflection.callStaticMethod('com.cocos.game/AppActivity', 'setOrientation', '(Ljava/lang/String;)V', \"L\")\r\n                this.adjustFunction = this.AdjustViewLandscape;\r\n                break;\r\n        }\r\n        this.adjustFunction();\r\n        window.addEventListener(\"resize\", (async () => {\r\n            if (this.isCanUpdata) {\r\n                this.isCanUpdata = false\r\n                await DelayTime.getInstance.StartDT_NotClear(delayTime)\r\n                this.adjustFunction()\r\n                this.isCanUpdata = true\r\n            }\r\n            else\r\n                console.error(\"等待刷新......\");\r\n        }))\r\n        if (window.jsb) //手动调用触发 Wdiget 组件重新布局\r\n            game.emit('resize', true)\r\n    }\r\n    static AdjustViewPortrait() {\r\n        let canvasSize = this.getWinSize();\r\n        if (!this.curDR)\r\n            this.curDR = view.getDesignResolutionSize()\r\n        let cvs = find('Canvas').getComponent(UITransform);\r\n\r\n        if (canvasSize.width >= this.curDR.width || canvasSize.height / canvasSize.width <= (this.curDR.height / this.curDR.width)) {\r\n            var width = canvasSize.width * (this.curDR.height / canvasSize.height);\r\n            view.setDesignResolutionSize(width, this.curDR.height, ResolutionPolicy.FIXED_HEIGHT);\r\n        }\r\n        else {\r\n            var height = canvasSize.height * (this.curDR.width / canvasSize.width);\r\n            view.setDesignResolutionSize(this.curDR.width, height, ResolutionPolicy.FIXED_HEIGHT)\r\n        }\r\n\r\n    }\r\n    static AdjustViewLandscape() {\r\n        let canvasSize = this.getWinSize();\r\n        if (!this.curDR)\r\n            this.curDR = view.getDesignResolutionSize()\r\n        let cvs = find('Canvas').getComponent(UITransform);\r\n        if (canvasSize.height >= this.curDR.width || canvasSize.width / canvasSize.height <= (this.curDR.height / this.curDR.width)) {\r\n            var width = canvasSize.height * (this.curDR.height / canvasSize.width);\r\n            view.setDesignResolutionSize(1280, width, ResolutionPolicy.FIXED_WIDTH);\r\n\r\n        }\r\n        else {\r\n            var height = canvasSize.width * (this.curDR.width / canvasSize.height);\r\n            view.setDesignResolutionSize(height, this.curDR.height, ResolutionPolicy.FIXED_WIDTH)\r\n        }\r\n\r\n    }\r\n\r\n\r\n    static AdjustView() {\r\n\r\n        let windowSize = screen.windowSize;\r\n        if (!this.curDR)\r\n            this.curDR = view.getDesignResolutionSize()\r\n        if (this.checkWindowOrientation() == macro.ORIENTATION_LANDSCAPE) {\r\n            view.setOrientation(macro.ORIENTATION_LANDSCAPE);\r\n            if (windowSize.height > windowSize.width) {\r\n                screen.windowSize = size(windowSize.width, windowSize.height);\r\n            }\r\n            view.setDesignResolutionSize(this.curDR.height, this.curDR.width, ResolutionPolicy.FIXED_WIDTH);\r\n        } else {\r\n            view.setOrientation(macro.ORIENTATION_PORTRAIT);\r\n            if (windowSize.width > windowSize.height) {\r\n                screen.windowSize = size(windowSize.height, windowSize.width);\r\n            }\r\n            view.setDesignResolutionSize(this.curDR.width, this.curDR.height, ResolutionPolicy.FIXED_HEIGHT);\r\n        }\r\n\r\n    }\r\n    static getWinSize() {\r\n        return { width: window.innerWidth, height: window.innerHeight };\r\n    }\r\n    static checkWindowOrientation() {\r\n        if (window.innerHeight > window.innerWidth)\r\n            return 1\r\n        else\r\n            return 2\r\n    }\r\n}\r\n\r\n"]}
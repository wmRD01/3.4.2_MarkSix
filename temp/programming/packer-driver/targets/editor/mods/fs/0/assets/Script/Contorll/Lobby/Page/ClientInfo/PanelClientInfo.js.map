{"version":3,"sources":["file:///C:/CocosProject/3.4.2_MarkSix/assets/Script/Contorll/Lobby/Page/ClientInfo/PanelClientInfo.ts"],"names":["assetManager","Label","Sprite","SpriteFrame","_decorator","BaseComponent","Player","RequestGPG","EventMng","NotificationType","LobbyStateEvent","PublicData","PanelLoading","PublicModel","ccclass","property","PanelClientInfo","start","show","isNeedUpdata","isLoading","getInstance","mapEvnet","get","Panel","on","ActivePanelClientInfo","activePanel","ChangePlayerPicture","onChangePlayerPicture","UpDataPlayer","onUpdataPlayer","testGet","repon","console","log","onEnable","instance","openLoading","startDelay","body","Body","NeedToken","MyInfo","sign","convertMD5","gpgApi","convert","URLSearchParams","toString","Request","setToken","gpgToken","fetchData","APIUrl","playAPI","API","responseMyInfo","bind","onDisable","onActivePanel","e","customEventData","hide","emit","spritePlayer","spriteFrame","ActivePanelClientEdit","bool","response","gpgInfo","data","photo","headPhoto","loadRemote","err","image","error","message","createWithImage","stopDelay","setTimeout","closeLoading","labelNickName","string","nickName","labelPhone","phoneNumber","labelEmail","email","_spriteFrame"],"mappings":"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","sourcesContent":["import { assetManager, EventTouch, ImageAsset, Label, Sprite, SpriteFrame, sys, _decorator } from 'cc';\r\nimport BaseComponent from '../../../../Model/ComponentBase';\r\nimport Player from '../../../../Model/Player';\r\nimport { RequestGPG } from '../../../Api/GPGAPI/RequestGPG';\r\nimport { ResponseGPG } from '../../../Api/GPGAPI/ResponseGPG';\r\nimport CryptoES from 'crypto-es';\r\nimport EventMng from '../../../../Manager/EventMng';\r\nimport { NotificationType } from '../../../../Enum/NotificationType';\r\nimport { LobbyStateEvent } from '../../../../Enum/LobbyStateEvent';\r\nimport PublicData from '../../../../Model/PublicData';\r\nimport PanelLoading from '../../../NoClearNode/PanelLoading';\r\nimport PublicModel from '../../../../Model/PublicModel';\r\nconst { ccclass, property } = _decorator;\r\n@ccclass('PanelClientInfo')\r\nexport default class PanelClientInfo extends BaseComponent {\r\n    isNeedUpdata: boolean = true;\r\n    isLoading: boolean = false;\r\n    @property(Sprite)\r\n    spritePlayer: Sprite;\r\n    @property(Label)\r\n    labelPhone: Label\r\n    @property(Label)\r\n    labelNickName: Label\r\n    @property(Label)\r\n    labelEmail: Label\r\n\r\n\r\n\r\n    async start() {\r\n        this.show()\r\n        this.isNeedUpdata = true;\r\n        this.isLoading = false;\r\n        EventMng.getInstance.mapEvnet.get(NotificationType.Panel).on(LobbyStateEvent.ActivePanelClientInfo, this.activePanel, this)\r\n        EventMng.getInstance.mapEvnet.get(NotificationType.Panel).on(LobbyStateEvent.ChangePlayerPicture, this.onChangePlayerPicture, this)\r\n        EventMng.getInstance.mapEvnet.get(NotificationType.Panel).on(LobbyStateEvent.UpDataPlayer, this.onUpdataPlayer, this)\r\n        // console.log(sys.browserType, sys.os);\r\n        // console.log(md5(\"12315235\"));\r\n\r\n    }\r\n    testGet(repon) {\r\n        console.log(repon);\r\n\r\n    }\r\n    async onEnable() {\r\n        if (!this.isNeedUpdata || this.isLoading) return;\r\n        this.isLoading = true\r\n        PanelLoading.instance.openLoading(\"資料讀取中\")\r\n        this.startDelay()\r\n        const body = new RequestGPG.Body.NeedToken.MyInfo()\r\n        body.sign = PublicModel.getInstance.convertMD5(PublicData.getInstance.gpgApi)\r\n        let convert = new URLSearchParams(body).toString()\r\n        await new RequestGPG.Request()\r\n            .setToken(Player.getInstance.gpgToken)\r\n            .fetchData(`${RequestGPG.APIUrl.playAPI}${RequestGPG.API.MyInfo}?${convert}`, this.responseMyInfo.bind(this))\r\n\r\n        this.isLoading = false\r\n    }\r\n    onDisable() {\r\n\r\n    }\r\n    onActivePanel(e: EventTouch, customEventData?: string) {\r\n        this.hide()\r\n        EventMng.getInstance.mapEvnet.get(NotificationType.Panel).emit(LobbyStateEvent.ChangePlayerPicture, this.spritePlayer.spriteFrame)\r\n        EventMng.getInstance.mapEvnet.get(NotificationType.Panel).emit(LobbyStateEvent.ActivePanelClientEdit, true)\r\n    }\r\n    onUpdataPlayer() {\r\n        this.isNeedUpdata = true\r\n    }\r\n    activePanel(bool: boolean) {\r\n        bool ? this.show() : this.hide()\r\n    }\r\n    async responseMyInfo(response: ResponseGPG.MyInfo.DataClass) {\r\n        console.log(\"MyInfo\", response)\r\n        Player.getInstance.gpgInfo = response;\r\n        // response.data.photo\r\n        console.log(response.data.photo.headPhoto);\r\n\r\n        assetManager.loadRemote(response.data.photo.headPhoto, (err, image: ImageAsset) => {\r\n\r\n            if (err) {\r\n                console.error(err.message);\r\n                return\r\n            }\r\n\r\n            EventMng.getInstance.mapEvnet.get(NotificationType.Panel).emit(LobbyStateEvent.ChangePlayerPicture, SpriteFrame.createWithImage(image))\r\n            this.isNeedUpdata = false;\r\n            if (this.stopDelay() < 1)\r\n                setTimeout(PanelLoading.instance.closeLoading.bind(PanelLoading.instance), 1000);\r\n            else\r\n                PanelLoading.instance.closeLoading()\r\n\r\n        })\r\n        this.labelNickName.string = response.data.nickName\r\n        this.labelPhone.string = response.data.phoneNumber\r\n        this.labelEmail.string = response.data.email\r\n    }\r\n    onChangePlayerPicture(_spriteFrame: SpriteFrame) {\r\n        this.spritePlayer.spriteFrame = _spriteFrame\r\n    }\r\n\r\n\r\n}\r\n\r\n"]}
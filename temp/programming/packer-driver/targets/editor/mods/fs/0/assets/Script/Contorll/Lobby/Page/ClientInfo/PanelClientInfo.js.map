{"version":3,"sources":["file:///C:/CocosProject/3.4.2_MarkSix/assets/Script/Contorll/Lobby/Page/ClientInfo/PanelClientInfo.ts"],"names":["assetManager","Label","Sprite","SpriteFrame","sys","_decorator","BaseComponent","RequestGPG","ccclass","property","PanelClientInfo","start","isData","isLoading","console","log","browserType","os","onEnable","Request","setToken","fetchData","responseMyInfo","bind","onValidateContactInfo","onDisable","body","Body","ValidateContactInfo","Email","setMethod","Method","POST","setBody","JSON","stringify","responseValidateContactInfo","onCertification","Certification","VerifyCode","sign","responseSendLoginVerification","response","Status","Code","sendBody","SendLoginVerification","loadRemote","err","image","error","message","spritePlayer","spriteFrame","createWithImage"],"mappings":"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","sourcesContent":["import { assetManager, ImageAsset, Label, Sprite, SpriteFrame, sys, _decorator } from 'cc';\r\nimport BaseComponent from '../../../../Model/ComponentBase';\r\nimport { RequestGPG } from '../../../Api/GPGAPI/RequestGPG';\r\nimport { ResponseGPG } from '../../../Api/GPGAPI/ResponseGPG';\r\nconst { ccclass, property } = _decorator;\r\n@ccclass('PanelClientInfo')\r\nexport default class PanelClientInfo extends BaseComponent {\r\n    isData: boolean = false;\r\n    isLoading: boolean = false;\r\n    @property(Sprite)\r\n    spritePlayer: Sprite;\r\n    @property(Label)\r\n    labelPlayerName: Label\r\n    @property(Label)\r\n    labelNickName: Label\r\n    start() {\r\n        this.isData = false;\r\n        this.isLoading = false;\r\n        console.log(sys.browserType, sys.os);\r\n\r\n    } async onEnable() {\r\n        if (this.isData || this.isLoading) return;\r\n        this.isLoading = true\r\n\r\n        await new RequestGPG.Request()\r\n            .setToken(\"Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IjExMkVFRDgwNzBBMEY5RkIzRUI3RDc3RkU3NjAxMTU0IiwidHlwIjoiYXQrand0In0.eyJuYmYiOjE2ODkxMjkzNjEsImV4cCI6MTY5MTcyMTM2MSwiaXNzIjoiaHR0cHM6Ly9pZHMuY2Vpcy50dyIsImNsaWVudF9pZCI6Im1hcmtfc2l4Iiwic3ViIjoiMjMyNCIsImF1dGhfdGltZSI6MTY4OTEyOTM2MSwiaWRwIjoibG9jYWwiLCJNZW1iZXJJRCI6IjIzMjQiLCJqdGkiOiI3RkNCM0QzQ0NDOUE3MjRGOUQ5M0YwNDZDMjNGODA1NCIsImlhdCI6MTY4OTEyOTM2MSwic2NvcGUiOlsibWVtYmVyLmluZm8udXNlciJdLCJhbXIiOlsibWtfcGhvbmUiXX0.agzZ_DHtp_dQQKfa1fRhJRwQAh8NnLk98jmqspD8RrnRq5TNqE-dTaf-53d61BraahHl2IO6qwPRk7wJr_RP6nuWYcoiVj4k3WGYG1qnpjuYA5vlq1Iyq2pPIr4eNq2pRV9mJAdKzsMVi1zVi5s7tz38sjpr470xa4QL4zXLluGIg-562pqnSAOtKiPQhCoCAzPSixI16BM3Ite90kw3a3gTcP_m7jA-ELfZxwS-pTHHSqQzhBTqCeMQk9uC3Rcuook_SseYN7cJoYOi_oc0wnNoMhalyLMbdhZKcktAMJ6ExuN0fj_RIxvAJT4lJrQictihPBE43qe7djkWV9uRUQ\")\r\n            .fetchData(\"https://play-api.ceis.tw/Member/MyInfo?sign=47b436c2cad162edc9a8035afc3c673f\", this.responseMyInfo.bind(this))\r\n        this.onValidateContactInfo()\r\n        this.isLoading = false\r\n    }\r\n    onDisable() {\r\n\r\n    }\r\n    /**進行發送驗證碼時，必須先通過確認手機是否被註冊過，確認沒有驗證過就會SendLog */\r\n    async onValidateContactInfo() {\r\n        /** */\r\n        let body = new RequestGPG.Body.ValidateContactInfo()\r\n        body.Email = \"wm.rd01@gmail.com\"\r\n        await new RequestGPG.Request()\r\n            .setMethod(RequestGPG.Method.POST)\r\n            .setBody(JSON.stringify(body))\r\n            .fetchData(\"https://ids.ceis.tw/Token/ValidateContactInfo\", this.responseValidateContactInfo.bind(this))\r\n\r\n    }\r\n    /**送出前須確認驗證碼的正確性，但前題是他必須得先需要註冊信箱時才會接這個function */\r\n    async onCertification() {\r\n        const body = new RequestGPG.Body.Certification()\r\n        body.Email = \"wm.rd01@gmail.com\"\r\n        body.VerifyCode = \"123124\"\r\n        body.sign = \"47b436c2cad162edc9a8035afc3c673f\"\r\n        await new RequestGPG.Request()\r\n            .setMethod(RequestGPG.Method.POST)\r\n            .setBody(JSON.stringify(body))\r\n            .fetchData(\"https://ids.ceis.tw/Member/Certification\", this.responseSendLoginVerification.bind(this))\r\n    }\r\n\r\n    async responseValidateContactInfo(response: ResponseGPG.ValidateContactInfo.DataClass) {\r\n        console.log(\"ValidateContactInfo\", response)\r\n        /**代表此已經綁定過不可以綁定! */\r\n        if (response.Status.Code == \"0\") {\r\n            console.log(\"已存在請重新換組\");\r\n            return;\r\n\r\n        }\r\n        else {\r\n            console.log(\"恭喜信箱不存在，可繼續註冊\");\r\n            //*要改成手動送驗證碼\r\n            const sendBody = new RequestGPG.Body.SendLoginVerification()\r\n            sendBody.Email = \"wm.rd01@gmail.com\"\r\n            await new RequestGPG.Request()\r\n                .setMethod(RequestGPG.Method.POST)\r\n                .setBody(JSON.stringify(sendBody))\r\n                .fetchData(\"https://ids.ceis.tw/Token/SendLoginVerification\", this.responseSendLoginVerification.bind(this))\r\n        }\r\n\r\n    }\r\n    async responseMyInfo(response: ResponseGPG.MyInfo.DataClass) {\r\n        console.log(\"MyInfo\", response)\r\n        // response.data.photo\r\n        assetManager.loadRemote(\"https://img.ceis.tw/Member/Avatar/2.jpg\", (err, image: ImageAsset) => {\r\n            if (err) {\r\n                console.error(err.message);\r\n                return\r\n            }\r\n            this.spritePlayer.spriteFrame = SpriteFrame.createWithImage(image)\r\n            // this.labelNickName.string= response.data.nickName\r\n            // this.labelPlayerName.string= response.data.\r\n            this.isData = true;\r\n        })\r\n\r\n    }\r\n    /**驗證碼發送是否成功 */\r\n    responseSendLoginVerification(response: ResponseGPG.SendLoginVerification.DataClass) {\r\n        console.log(\"SendLoginVerification\", response)\r\n        if (response.Status.Code == \"0\") {\r\n            console.log(\"過關惹\");\r\n\r\n        }\r\n    }\r\n}"]}
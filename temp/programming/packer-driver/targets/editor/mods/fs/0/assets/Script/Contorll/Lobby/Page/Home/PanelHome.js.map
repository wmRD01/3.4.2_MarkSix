{"version":3,"sources":["file:///C:/CocosProject/3.4.2_MarkSix/assets/Script/Contorll/Lobby/Page/Home/PanelHome.ts"],"names":["Marquee","Timer","Button","Component","instantiate","Label","Node","Prefab","UITransform","_decorator","NotificationType","LobbyStateEvent","PageAction","EventMng","BaseComponent","PublicModel","RequestGPG","Player","PublicData","PanelLoading","BallData","ccclass","property","PanelHome","onLoad","marquee","labelMarquee","addComponent","timer","labelTime","getInstance","gpgToken","handleURLData","window","location","href","token","onEnable","requestDrawHistory","requestDrawUpcoming","lastIssueID","currentIssueID","requesMyScore","instance","closeLoading","start","onDisable","Promise","resolve","reject","body","Body","NeedToken","DrawHistory","top","sign","convertSign","convert","URLSearchParams","toString","Request","setToken","fetchData","gpgUrlPlayApi","API","responseDrawHistory","bind","response","data","getDate","issueID","labelLastDrawIssueID","string","getday","convertDateDay","openDate","split","labelLastDrawDay","index","drawCode","length","_node","ballItem","_class","getComponent","lastDrawCodeLayout","addChild","init","Number","cancel","labelContent","label","node","DrawUpcoming","convertMD5","gpgApi","responseDrawUpcoming","labelCurrentDrawIssueID","Date_A","Date","Date_B","serverNowTime","Date_C","setTimer","Math","abs","getTime","today","MyScore","sDate","getFullYear","getMonth","eDate","getMonthAllDay","My_Score","responseMyScore","labelMonth","console","log","labelMyPoint","totalScore","onGoPage","e","customEventData","isNaN","error","eventEmit","ChangePointPage","mapEvnet","get","Page","emit","ChangeTo","_url","undefined","arr","obj","Object","cut","bindLabel","rightBorder","parent","width","startMarque","message","updateRenderData","leftBorder","resetPos","isAction","update","dt","currentPos","getPosition","x","setPosition","speed","y","z","reset","countTime","setTimeNoTimer","str","num","formatMillisecond"],"mappings":"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","sourcesContent":["import { Button, Component, EventTouch, instantiate, Label, Node, Prefab, UITransform, v3, _decorator } from 'cc';\r\nimport { NotificationType } from '../../../../Enum/NotificationType';\r\nimport { LobbyStateEvent } from '../../../../Enum/LobbyStateEvent';\r\nimport { PageAction } from '../../../../Enum/PageAction';\r\nimport EventMng from '../../../../Manager/EventMng';\r\nimport BaseComponent from '../../../../Model/ComponentBase';\r\nimport PageControll from '../../PageControll';\r\nimport PublicModel from '../../../../Model/PublicModel';\r\nimport { RequestGPG } from '../../../Api/GPGAPI/RequestGPG';\r\nimport Player from '../../../../Model/Player';\r\nimport { ResponseGPG } from '../../../Api/GPGAPI/ResponseGPG';\r\nimport PublicData from '../../../../Model/PublicData';\r\nimport PanelLoading from '../../../NoClearNode/PanelLoading';\r\nimport { URLVlaue } from '../../../Api/SendCommand';\r\nimport BallData from '../../../../Model/BallData';\r\n\r\n\r\n\r\nconst { ccclass, property } = _decorator;\r\n@ccclass('PanelHome')\r\nexport default class PanelHome extends BaseComponent {\r\n    @property(Node)\r\n    lastDrawCodeLayout: Node\r\n    @property(Node)\r\n    labelContent: Node;\r\n\r\n    @property(Prefab)\r\n    ballItem: Prefab\r\n\r\n    @property(Label)\r\n    labelTime: Label;\r\n    @property(Label)\r\n    labelCurrentTitle: Label;\r\n    @property(Label)\r\n    labelCurrentDrawIssueID: Label;\r\n    @property(Label)\r\n    labelLastDrawCode: Label[] = []\r\n    @property(Label)\r\n    labelLastDrawIssueID: Label;\r\n    @property(Label)\r\n    labelLastDrawDay: Label;\r\n    @property(Label)\r\n    labelMarquee: Label;\r\n    @property(Label)\r\n    labelMonth: Label;\r\n    @property(Label)\r\n    labelPointTitle: Label;\r\n    @property(Label)\r\n    labelMyPoint: Label;\r\n    @property(Label)\r\n    labelDetail: Label;\r\n    @property(Label)\r\n    labelGiftTitle1: Label\r\n    @property(Label)\r\n    labelGiftTitle2: Label\r\n    @property(Button)\r\n    btnMoreDraw: Button;\r\n    @property(Button)\r\n    btnPointDetail: Button;\r\n    @property(Button)\r\n    btnGoChooese: Button;\r\n\r\n    marquee: Marquee;\r\n    timer: Timer;\r\n    currentIssueID: number;\r\n    lastIssueID: number;\r\n    onLoad() {\r\n        this.marquee = this.labelMarquee.addComponent(Marquee)\r\n        this.timer = this.labelTime.addComponent(Timer);\r\n        /**取TOKEN */\r\n        Player.getInstance.gpgToken = (this.handleURLData(window.location.href) as URLVlaue).token\r\n\r\n    }\r\n    async onEnable() {\r\n        await this.requestDrawHistory()\r\n        await this.requestDrawUpcoming()\r\n        if (this.lastIssueID != this.currentIssueID) {\r\n            //TODO 製做我的積分\r\n            await this.requesMyScore()\r\n            /**代表更新最新一期 */\r\n            this.lastIssueID = this.currentIssueID;\r\n        }\r\n        PanelLoading.instance.closeLoading()\r\n    }\r\n    start() {\r\n        // this.marquee.startMarque(\"HIHIHI\")\r\n        // this.timer.setTime(100)\r\n    }\r\n\r\n    onDisable() {\r\n\r\n    }\r\n    //#region  DrawHistory\r\n    async requestDrawHistory() {\r\n        return new Promise<void>(async (resolve, reject) => {\r\n            const body = new RequestGPG.Body.NeedToken.DrawHistory()\r\n            body.top = \"1\"\r\n            body.sign = PublicModel.getInstance.convertSign(body, RequestGPG.Body.NeedToken.DrawHistory)\r\n            let convert = new URLSearchParams(body).toString()\r\n            await new RequestGPG.Request()\r\n                .setToken(Player.getInstance.gpgToken)\r\n                .fetchData(`${PublicData.getInstance.gpgUrlPlayApi}${RequestGPG.API.DrawHistory}?${convert}`, this.responseDrawHistory.bind(this))\r\n            resolve();\r\n        })\r\n    }\r\n    responseDrawHistory(response?: ResponseGPG.DrawHistory.DataClass) {\r\n        if (response.data) {\r\n            let getDate = response.data[0]\r\n            if (this.currentIssueID == getDate.issueID) return\r\n            this.currentIssueID = getDate.issueID;\r\n            this.labelLastDrawIssueID.string = `第${getDate.issueID.toString()}期`\r\n\r\n            /**不需要week日 */\r\n            // console.log(PublicModel.getInstance.convertDate(getDate.openDate).split(\"(\")[0]);\r\n\r\n            let getday = PublicModel.getInstance.convertDateDay(getDate.openDate).split(\"(\")[0]\r\n            this.labelLastDrawDay.string = `${getday}開獎結果`\r\n            for (let index = 0; index < getDate.drawCode.length; index++) {\r\n                if (index == 6) return;\r\n                let _node = instantiate(this.ballItem)\r\n                let _class = _node.getComponent(BallData);\r\n                this.lastDrawCodeLayout.addChild(_node);\r\n                _class.init(Number(getDate.drawCode[index])).cancel()\r\n                this.labelContent.addChild(_class.label.node);\r\n            }\r\n        }\r\n    }\r\n    //#endregion\r\n    //#region  DrawUpcoming\r\n    async requestDrawUpcoming() {\r\n        return new Promise<void>(async (resolve, reject) => {\r\n            const body = new RequestGPG.Body.NeedToken.DrawUpcoming()\r\n            body.sign = PublicModel.getInstance.convertMD5(PublicData.getInstance.gpgApi)\r\n            let convert = new URLSearchParams(body).toString()\r\n            await new RequestGPG.Request()\r\n                .setToken(Player.getInstance.gpgToken)\r\n                .fetchData(`${PublicData.getInstance.gpgUrlPlayApi}${RequestGPG.API.DrawUpcoming}?${convert}`, this.responseDrawUpcoming.bind(this))\r\n            resolve()\r\n        })\r\n    }\r\n    responseDrawUpcoming(response?: ResponseGPG.DrawUpcoming.DataClass) {\r\n        let getDate = response.data[0]\r\n        this.labelCurrentDrawIssueID.string = `第${(getDate.issueID).toString()}期`\r\n        // this.timer.setTimeNoTimer(PublicModel.getInstance.convertDateTime(getDate.openDate))\r\n        var Date_A = new Date(getDate.openDate);\r\n        var Date_B = new Date(getDate.serverNowTime);\r\n        //@ts-ignore\r\n        var Date_C = new Date(Date_B - Date_A);\r\n\r\n        this.timer.setTimer(Math.abs(Date_C.getTime()))\r\n\r\n\r\n        PublicData.getInstance.today = getDate.openDate\r\n    }\r\n    //#endregion\r\n\r\n    //#region MyScore\r\n    async requesMyScore() {\r\n        return new Promise<void>(async (resolve, reject) => {\r\n            const body = new RequestGPG.Body.NeedToken.MyScore()\r\n            const getDate = new Date(PublicData.getInstance.today)\r\n            body.sDate = `${getDate.getFullYear()}-${getDate.getMonth() + 1}-01`\r\n            body.eDate = `${getDate.getFullYear()}-${getDate.getMonth() + 1}-${PublicModel.getInstance.getMonthAllDay(PublicData.getInstance.today)}`\r\n            body.sign = PublicModel.getInstance.convertSign(body, RequestGPG.Body.NeedToken.MyScore)\r\n            let convert = new URLSearchParams(body).toString()\r\n            await new RequestGPG.Request()\r\n                .setToken(Player.getInstance.gpgToken)\r\n                .fetchData(`${PublicData.getInstance.gpgUrlPlayApi}${RequestGPG.API.My_Score}?${convert}`, this.responseMyScore.bind(this))\r\n            resolve()\r\n        })\r\n    }\r\n    responseMyScore(response?: ResponseGPG.My_Score.DataClass) {\r\n        const getDate = new Date(PublicData.getInstance.today)\r\n        this.labelMonth.string = `(${getDate.getMonth() + 1}/1~${getDate.getMonth() + 1}/${PublicModel.getInstance.getMonthAllDay(PublicData.getInstance.today)})`\r\n        if (response.data) {\r\n            console.log(\"玩家紀錄\", response);\r\n            this.labelMyPoint.string = response.data.totalScore.toString();\r\n        }\r\n        else {\r\n            this.labelMyPoint.string = \"0\"\r\n        }\r\n    }\r\n    //#endregion\r\n    onGoPage(e: EventTouch, customEventData?: string) {\r\n        let split = customEventData.split('-')\r\n        if (isNaN(Number(split[0])))\r\n            console.error(\"錯誤啦!!!是不是忘記設定\");\r\n        this.eventEmit(LobbyStateEvent.ChangePointPage, null, split[1])\r\n        EventMng.getInstance.mapEvnet.get(NotificationType.Page).emit(PageAction.ChangeTo, Number(split[0]))\r\n    }\r\n    handleURLData(_url: string) {\r\n        //  _url = \"https://play1.godplay.app/10001/index.html?loginType=web&token=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJ0aW1lIjoxNjY4NzYyMjcwMDQ1LCJ1aWQiOiJYUGpST1oiLCJkYyI6IkdQRyIsImFnZW50SWQiOiJ0ckUzeW1XaURMYjIiLCJicmFuZElkIjoiR1BHIiwiYnJhbmRUaXRsZSI6IkdQRyIsImdhbWVJZCI6IjEwMDAxIiwiaWF0IjoxNjY4NzYyMjcwLCJleHAiOjE2Njg3NjU4NzB9.k_GVGPiQCjWxhFG3SGM2zoSy_ggN2cZXuUQ5GvqZib_0TCJ2ul9K5xbTKkgwm7OUw7nMCWLWlwERHc0MMF586SgjuQe9W7SoRSMaBtw_AkiKNn4S1NMvhemgNAdIyjL7I1Gg5xyT-x110RF73lF-yt-n6KKTP3TGkd7wR9_fPz8&record=https://backendsystem.godplay.app/wList&dc=GPG&agentId=trE3ymWiDLb2&GGID=1&lang=tw&forceExchange=true&providerlogo=true\"\r\n        // console.log(_url.split(\"?\")[1].split(\"&\"));\r\n        // console.log(_url.split(\"?\")[1]);\r\n\r\n        if (_url.split(\"?\")[1] == undefined) return undefined\r\n\r\n        let arr = _url.split(\"?\")[1].split(\"&\")\r\n        let obj = new Object()\r\n        for (let index = 0; index < arr.length; index++) {\r\n            let cut = arr[index].split(\"=\")\r\n            obj[cut[0]] = cut[1]\r\n        }\r\n        // console.log(obj);\r\n        return obj\r\n    }\r\n}\r\n\r\nclass Marquee extends Component {\r\n    bindLabel: Label;\r\n    leftBorder: number;\r\n    rightBorder: number;\r\n    isAction: boolean;\r\n    /**基本上100 OK */\r\n    speed: number = 100;\r\n    onLoad() {\r\n        this.bindLabel = this.node.getComponent(Label)\r\n        this.rightBorder = this.bindLabel.node.parent.getComponent(UITransform).width + 10//額外預留\r\n    }\r\n    startMarque(message: string) {\r\n        this.bindLabel.string = message\r\n        this.bindLabel.updateRenderData(true)\r\n        this.leftBorder = -(this.bindLabel.getComponent(UITransform).width + 10)\r\n        this.resetPos()\r\n        this.isAction = true;\r\n    }\r\n    update(dt: number) {\r\n\r\n        if (this.isAction) {\r\n            let currentPos = this.bindLabel.node.getPosition()\r\n            if (currentPos.x < this.leftBorder) {\r\n                this.resetPos()\r\n                currentPos = this.bindLabel.node.getPosition()\r\n            }\r\n            // console.log(currentPos.x);\r\n\r\n            // console.log(currentPos.x - (dt * this.speed));\r\n            // \r\n            this.bindLabel.node.setPosition(currentPos.x - (dt * this.speed), currentPos.y, currentPos.z)\r\n\r\n        }\r\n    }\r\n    resetPos() {\r\n        let currentPos = this.bindLabel.node.getPosition()\r\n        this.bindLabel.node.setPosition(this.rightBorder, currentPos.y, currentPos.z)\r\n    }\r\n}\r\n\r\nclass Timer extends Component {\r\n    bindLabel: Label;\r\n    countTime: number;\r\n    isAction: boolean\r\n    onLoad() {\r\n        this.bindLabel = this.node.getComponent(Label)\r\n        this.bindLabel.string = \"\"\r\n    }\r\n    reset() {\r\n        this.countTime = 0\r\n        this.isAction = false\r\n    }\r\n    setTimeNoTimer(str: string) {\r\n        this.bindLabel.string = str\r\n    }\r\n    setTimer(num: number) {\r\n        this.reset()\r\n        this.countTime = num\r\n        this.isAction = true\r\n    }\r\n\r\n    update(dt: number) {\r\n        if (this.isAction) {\r\n            this.countTime -= (dt * 1000)\r\n            if (this.countTime < 0) this.reset()\r\n            this.bindLabel.string = PublicModel.getInstance.formatMillisecond(this.countTime, true)\r\n        }\r\n    }\r\n\r\n\r\n}"]}
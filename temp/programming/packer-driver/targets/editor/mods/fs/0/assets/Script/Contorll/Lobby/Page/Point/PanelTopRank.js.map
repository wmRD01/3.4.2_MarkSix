{"version":3,"sources":["file:///C:/CocosProject/3.4.2_MarkSix/assets/Script/Contorll/Lobby/Page/Point/PanelTopRank.ts"],"names":["instantiate","Node","Prefab","_decorator","AssetType","AssetMng","BaseComponent","AutoFollow","RankItmeData","RequestGPG","PublicModel","PublicData","Player","ccclass","property","PanelTopRank","start","waitStateCheck","Sprite","layoutRank","removeAllChildren","requesTopScore","Promise","resolve","reject","body","Body","NeedToken","TopScore","todayDate","Date","getInstance","today","sDate","getFullYear","getMonth","eDate","getDate","sign","convertSign","convert","URLSearchParams","toString","console","log","Request","setToken","gpgToken","fetchData","gpgUrlPlayApi","API","responseTopScore","bind","response","index","data","length","totalScore","children","_node","prefabRankItem","_class","getComponent","init","labelName","addComponent","createNewTarget","labelPointCount","spriteBG","setTarget","labelContent","addChild","node","spriteBGContent"],"mappings":"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","sourcesContent":["import { instantiate, Node, Prefab, _decorator } from 'cc';\r\nimport { AssetType } from '../../../../Enum/AssetType';\r\nimport AssetMng from '../../../../Manager/AssetMng';\r\nimport BaseComponent from '../../../../Model/ComponentBase';\r\nimport AutoFollow from '../../../../Model/AutoFollow';\r\nimport RankItmeData from '../../../../Model/RankItmeData';\r\nimport { RequestGPG } from '../../../Api/GPGAPI/RequestGPG';\r\nimport PublicModel from '../../../../Model/PublicModel';\r\nimport PublicData from '../../../../Model/PublicData';\r\nimport { ResponseGPG } from '../../../Api/GPGAPI/ResponseGPG';\r\nimport Player from '../../../../Model/Player';\r\nconst { ccclass, property } = _decorator;\r\n@ccclass('PanelTopRank')\r\nexport default class PanelTopRank extends BaseComponent {\r\n    @property(Prefab)\r\n    prefabRankItem: Prefab\r\n    @property(Node)\r\n    layoutRank: Node\r\n    @property(Node)\r\n    labelContent: Node;\r\n    @property(Node)\r\n    spriteBGContent: Node;\r\n    async start() {\r\n        await AssetMng.waitStateCheck(AssetType.Sprite)\r\n        this.layoutRank.removeAllChildren()\r\n\r\n        await this.requesTopScore()\r\n    }\r\n    async requesTopScore() {\r\n        return new Promise<void>(async (resolve, reject) => {\r\n            const body = new RequestGPG.Body.NeedToken.TopScore()\r\n            const todayDate = new Date(PublicData.getInstance.today)\r\n            body.sDate = `${todayDate.getFullYear()}-${todayDate.getMonth() + 1}-1`\r\n            body.eDate = `${todayDate.getFullYear()}-${todayDate.getMonth() + 1}-${todayDate.getDate()}`\r\n            body.sign = PublicModel.getInstance.convertSign(body, RequestGPG.Body.NeedToken.TopScore)\r\n            let convert = new URLSearchParams(body).toString()\r\n            console.log(body);\r\n            console.log(convert);\r\n            await new RequestGPG.Request()\r\n                .setToken(Player.getInstance.gpgToken)\r\n                .fetchData(`${PublicData.getInstance.gpgUrlPlayApi}${RequestGPG.API.TopScore}?${convert}`, this.responseTopScore.bind(this))\r\n            resolve()\r\n        })\r\n    }\r\n    responseTopScore(response?: ResponseGPG.TopScore.DataClass) {\r\n        console.log(\"排行榜\", response);\r\n        for (let index = 0; index < response.data.length; index++) {\r\n            if (response.data[index].totalScore == 0) continue;\r\n            if (this.layoutRank.children.length >= 100) break;\r\n            let _node = instantiate(this.prefabRankItem)\r\n            let _class = _node.getComponent(RankItmeData)\r\n            _class.init(response.data[index])\r\n            _class.labelName.addComponent(AutoFollow).createNewTarget()\r\n            _class.labelPointCount.addComponent(AutoFollow).createNewTarget()\r\n            _class.spriteBG.addComponent(AutoFollow).setTarget(_node)\r\n            this.labelContent.addChild(_class.labelName.node)\r\n            this.labelContent.addChild(_class.labelPointCount.node)\r\n            this.spriteBGContent.addChild(_class.spriteBG.node)\r\n            this.layoutRank.addChild(_node)\r\n        }\r\n    }\r\n\r\n}"]}
{"version":3,"sources":["file:///C:/CocosProject/3.4.2_MarkSix/assets/Script/View/MainGame.ts"],"names":["_decorator","director","find","js","Node","PanelUI","CommandType","LangType","CheckLoadingType","PublicData","WebSocketEvent","CheckLoading","BaseSingletonComponent","GameSceneName","gbet","SocketSetting","GameEvent","PanelClientCoin","PanelGameMessage","PanelTimer","PanelLoading","SingletManager","DEV","PanelTextAnimation","AssetMng","AssetType","Player","PlayerIdentity","CanvasControll","ccclass","property","MainGame","onLoad","active","getInstance","endWork","isGameSence","currentScene","GameRoom","isResetView","instance","closeLoading","onEnable","setEvent","SetOrientation","eventOrientation","start","eventEmit","ResetView","checkLanguage","Server","Game","openLoading","t","isResetProcessing","index","arr_ComponentBaseClass","length","setLanguage","identity","Guest","panelClientCoin","hide","panelUI","node","on","EventType","TOUCH_END","eventPushNotificationGuset","waitStateCheck","Sprite","Music","checkAllEnd","WebSocketSendCommand","gori","onDisable","deletEvent","onDestroy","delete","getClassName","str","isLandscape","loadScene","backLobby","pwlby","Lobby","castAPI","send","onRefreshRoomState","onBetClear","gbcl","onOwnerBet","temp","chip","kind","Math","floor","random","onBetCheck","gbcf","onReferLastBet","gbrt","onSquintProcess","onSquintEnd","gpe","onResestPC","window","isPhone","onResetPhoneLandscape","onResetPhonePortrait"],"mappings":"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","sourcesContent":["import PanelUI from '../Contorll/GameRoom/UI/PanelUI';\r\nimport { _decorator, director, Game, game, find, js, Node, profiler, setDisplayStats } from 'cc';\r\nimport { CommandType } from '../Enum/CommandType';\r\nimport { LangType } from '../Enum/LangType';\r\nimport { CheckLoadingType } from '../Enum/CheckLoadingType';\r\nimport PublicData from '../Model/PublicData';\r\nimport { WebSocketEvent } from '../Enum/WebSocketEvent';\r\nimport CheckLoading from '../Model/CheckLoading';\r\nimport BaseSingletonComponent from '../../Patten/Singleton/BaseSingletonComponent';\r\nimport { GameSceneName } from '../Enum/GameSenceName';\r\nimport { gbet } from '../Contorll/Api/SendCommand';\r\nimport SocketSetting from '../Socket/SocketSetting';\r\nimport { GameEvent } from '../Enum/GameEvent';\r\n\r\nimport PanelClientCoin from '../Contorll/Lobby/PanelClientCoin';\r\nimport PanelGameMessage from '../Contorll/Lobby/PanelGameMessage';\r\nimport PanelTimer from '../Contorll/Lobby/PanelTimer';\r\n\r\nimport PanelLoading from '../Contorll/NoClearNode/PanelLoading';\r\nimport SingletManager from '../../Patten/Singleton/SingletonManger';\r\nimport { DEV } from 'cc/env';\r\nimport PanelTextAnimation from '../Contorll/GameRoom/PanelTextAnimation/PanelTextAnimation';\r\nimport AssetMng from '../Manager/AssetMng';\r\nimport { AssetType } from '../Enum/AssetType';\r\nimport Player from '../Model/Player';\r\nimport { PlayerIdentity } from '../Enum/PlayerIdentity';\r\nimport CanvasControll from '../Contorll/NoClearNode/CanvasControll';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('MainGame')\r\nexport class MainGame extends BaseSingletonComponent<MainGame>() {\r\n\r\n    @property(PanelClientCoin)\r\n    panelClientCoin: PanelClientCoin\r\n    @property(PanelGameMessage)\r\n    panelGameMessage: PanelGameMessage\r\n\r\n    @property(PanelTimer)\r\n    panelTimer: PanelTimer\r\n\r\n    @property(PanelUI)\r\n    panelUI: PanelUI;\r\n\r\n    @property(PanelTextAnimation)\r\n    panelTextAnimation: PanelTextAnimation;\r\n    onLoad(): void {\r\n        // console.error(DEV);\r\n\r\n        if (DEV) {\r\n            // Player.getInstance.identity = PlayerIdentity.Guest\r\n            // window.isPhone = true\r\n        }\r\n\r\n        find(\"Canvas/PanelTest\").active = DEV\r\n        /**測試功能 */\r\n        CheckLoading.getInstance.endWork(CheckLoadingType.isGameSence)\r\n        PublicData.getInstance.currentScene = GameSceneName.GameRoom\r\n        super.onLoad()\r\n        PublicData.getInstance.isResetView = true\r\n        PanelLoading.instance.closeLoading()\r\n        /**由於Panel是動態仔入，因此得用Find去抓，或者....再想想，因為在介面上操作的話等於是寫死(? */\r\n        // this.panelTable = find(\"3DNode/PanelTable\").getComponent(PanelTable)\r\n        // this.panelBetState = find(\"Canvas/PanelBetState\").getComponent(PanelBetState)\r\n        // this.panelShowdownResult = find(\"Canvas/PanelShowdownResult\").getComponent(PanelShowdownResult)\r\n        // this.panelClientCoin = find(\"Canvas/PanelClientCoin\").getComponent(PanelClientCoin)\r\n        // this.panelGameMessage = find(\"Canvas/PanelGameMessage\").getComponent(PanelGameMessage)\r\n        // this.panelLimitBet = find(\"Canvas/PanelLimitBet\").getComponent(PanelLimitBet)\r\n        // this.panelTimer = find(\"Canvas/PanelTimer\").getComponent(PanelTimer)\r\n        // this.panelUI = find(\"Canvas/PanelUI\").getComponent(PanelUI)\r\n        // this.panelCardSequence = find(\"Canvas/PanelCardSequence\").getComponent(PanelCardSequence)\r\n        // this.panelShuffleCard = find(\"Canvas/PanelShuffleCard\").getComponent(PanelShuffleCard)\r\n\r\n\r\n\r\n    }\r\n    onEnable() {\r\n        this.setEvent(GameEvent.SetOrientation, this.eventOrientation)\r\n    }\r\n    /**\r\n     * 測試內存\r\n     */\r\n    async start() {\r\n        //建立連線\r\n        this.eventEmit(GameEvent.ResetView)\r\n        await SocketSetting.checkLanguage(LangType.Server)\r\n        await SocketSetting.checkLanguage(LangType.Game)\r\n        PanelLoading.instance.openLoading(SocketSetting.t(\"E_0004\", LangType.Game))\r\n        PublicData.getInstance.isResetProcessing = true\r\n        PublicData.getInstance.isResetView = true;\r\n        /**初始化全部語系 */\r\n        for (let index = 0; index < PublicData.getInstance.arr_ComponentBaseClass.length; index++) {\r\n            PublicData.getInstance.arr_ComponentBaseClass[index].setLanguage()\r\n        }\r\n        /** forCAST用 */\r\n        if (Player.getInstance.identity == PlayerIdentity.Guest) {\r\n            this.panelClientCoin.hide()\r\n            this.panelUI.hide()\r\n            CanvasControll.instance.node.on(Node.EventType.TOUCH_END, this.eventPushNotificationGuset, this)\r\n        }\r\n        await AssetMng.waitStateCheck(AssetType.Sprite)\r\n        await AssetMng.waitStateCheck(AssetType.Music)\r\n        await CheckLoading.getInstance.checkAllEnd()\r\n\r\n        this.eventEmit(WebSocketEvent.WebSocketSendCommand, CommandType.gori)\r\n\r\n    }\r\n    onDisable() {\r\n        this.deletEvent(GameEvent.SetOrientation, this.eventOrientation)\r\n    }\r\n    onDestroy() {\r\n        /**清除之前資料 */\r\n        PublicData.getInstance.arr_ComponentBaseClass.length = 0\r\n        SingletManager.instance.delete(js.getClassName(this))\r\n    }\r\n    eventOrientation(str: string) {\r\n        /**如果當前是橫版且接收到字串為橫 */\r\n        if (PublicData.getInstance.isLandscape && str == \"portrait\")\r\n            PublicData.getInstance.isLandscape = false\r\n        else if (!PublicData.getInstance.isLandscape && str == \"landscape\")\r\n            PublicData.getInstance.isLandscape = true\r\n        else return\r\n        director.loadScene(GameSceneName.GameRoom)\r\n    }\r\n    backLobby() {\r\n        this.eventEmit(WebSocketEvent.WebSocketSendCommand, CommandType.pwlby);\r\n        director.loadScene(GameSceneName.Lobby)\r\n    }\r\n    eventPushNotificationGuset() {\r\n        // console.error(\"送?\");\r\n        PublicData.getInstance.castAPI.send(\"guest\", {})\r\n    }\r\n\r\n    /**以下測試 */\r\n\r\n\r\n    onRefreshRoomState() {\r\n        this.eventEmit(WebSocketEvent.WebSocketSendCommand, CommandType.gori);\r\n    }\r\n    /**下注清除 */\r\n    onBetClear() {\r\n\r\n        this.eventEmit(WebSocketEvent.WebSocketSendCommand, CommandType.gbcl);\r\n    }\r\n    /**自身下注 */\r\n    onOwnerBet() {\r\n        for (let index = 0; index < 30; index++) {\r\n            let temp = new gbet()\r\n            temp.chip = 100\r\n            temp.kind = Math.floor(Math.random() * 5)\r\n            this.eventEmit(WebSocketEvent.WebSocketSendCommand, CommandType.gbet, temp);\r\n        }\r\n    }\r\n    /**下注確認 */\r\n    onBetCheck() {\r\n        //這要做什麼?\r\n        this.eventEmit(WebSocketEvent.WebSocketSendCommand, CommandType.gbcf);\r\n    }\r\n    /**參照上一局下注 */\r\n    onReferLastBet() {\r\n        //假設第一局我依然要傳給leo?還是要我們檔? 照傳\r\n        this.eventEmit(WebSocketEvent.WebSocketSendCommand, CommandType.gbrt);\r\n    }\r\n    /**瞇牌過程 */\r\n    onSquintProcess() {\r\n\r\n    }\r\n    /**瞇牌結束 */\r\n    onSquintEnd() {\r\n        this.eventEmit(WebSocketEvent.WebSocketSendCommand, CommandType.gpe);\r\n    }\r\n    onResestPC() {\r\n        window.isPhone = false\r\n        director.loadScene(GameSceneName.GameRoom)\r\n    }\r\n    onResetPhoneLandscape() {\r\n        window.isPhone = true\r\n        PublicData.getInstance.isLandscape = true\r\n        director.loadScene(GameSceneName.GameRoom)\r\n    }\r\n    onResetPhonePortrait() {\r\n        window.isPhone = true\r\n        PublicData.getInstance.isLandscape = false\r\n        director.loadScene(GameSceneName.GameRoom)\r\n    }\r\n\r\n}\r\n\r\n"]}
{"version":3,"sources":["file:///C:/CocosProject/3.4.2_MarkSix/assets/Image/tests/setCompressPNG.js"],"names":["fs","require","path","_compressSettings","sourcePath","process","argv","isCompress","parseInt","lookupDir","url","bo3D","existsSync","readdir","err","files","console","error","forEach","file","curPath","join","stat","statSync","isDirectory","pathHas3D","indexOf","readFile","data","obj","JSON","parse","importer","userData","wrdata","compressSettings","stringify","writeFile","log","isAbsolute","__dirname"],"mappings":"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","sourcesContent":["const fs = require('fs');\nconst path = require('path');\n\n\nconst _compressSettings = [\n// 0 一般貼圖\n{\n    \"useCompressTexture\": true,\n    \"presetId\": \"abLY678v5Dj7wdrAbDORxV\"\n},\n// 1 3D貼圖\n{\n    \"useCompressTexture\": true,\n    \"presetId\": \"02g2e6zdBE7byIWrLpKBEv\"\n}];\n\nlet sourcePath = process.argv[2];\nlet isCompress = parseInt(process.argv[3]);\n\nlet lookupDir = function(url, bo3D) {\n    if (!fs.existsSync(url)) {\n        return;\n    }\n    fs.readdir(url, (err, files) => {\n        if (err) {\n            console.error(err);\n            return;\n        }\n        files.forEach((file) => {\n            let curPath = path.join(url, file);\n            let stat = fs.statSync(curPath);\n            if (stat.isDirectory()) {\n\t\t\t\tlet pathHas3D = bo3D || (curPath.indexOf('3D') >= 0 || curPath.indexOf('FBX') >= 0 || curPath.indexOf('GLTF') >= 0);\n                lookupDir(curPath, pathHas3D); \t// 找尋所有目錄\n            } else {\n                if (file.indexOf('.meta') >= 0) {\n                    fs.readFile(curPath, (err, data) => {\n                        if (err) {\n                            console.error(err);\n                            return;\n                        }\n                        let obj = JSON.parse(data);\n                        if (obj && obj.importer && obj.importer === 'image' && obj.userData) {\n\t\t\t\t\t\t\tlet wrdata;\n\t\t\t\t\t\t\n                             obj.userData.compressSettings = _compressSettings[(bo3D) ? 1 : 0];\t\t// 設定壓縮材質\n                             wrdata = JSON.stringify(obj, null, 2);\n\n\n//                            if (obj.userData.compressSettings) {\n//                                obj.userData.compressSettings = undefined;\t\t\t\t\t\t\t\t// 清除壓縮材質\n//                                wrdata = JSON.stringify(obj, null, 2);\n//                            }\n                    \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (wrdata) {\n\t\t\t\t\t\t\t\tfs.writeFile(curPath, wrdata, (err) => {\n\t\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tconsole.log(curPath + ' success!!');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n                        }\n                    });\n                }\n            }\n        });\n    });\n}\n\nif (!path.isAbsolute(sourcePath)) {\n    sourcePath = path.join(__dirname, sourcePath)\n}\nlookupDir(sourcePath);"]}
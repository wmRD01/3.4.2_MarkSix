{"version":3,"sources":["file:///C:/CocosProject/3.4.2_MarkSix/assets/Plug/setCompressPNG/setCompressPNG.js"],"names":["fs","require","path","_compressSettings","useCompressTexture","presetId","sourcePath","process","argv","isCompress","parseInt","lookupDir","url","bo3D","existsSync","readdir","err","files","console","error","forEach","file","curPath","join","stat","statSync","isDirectory","pathHas3D","indexOf","readFile","data","obj","JSON","parse","importer","userData","wrdata","compressSettings","stringify","writeFile","log","isAbsolute","__dirname"],"mappings":"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","sourcesContent":["const fs = require('fs');\nconst path = require('path');\n\nconst _compressSettings = [\n    // 0 一般貼圖\n    {\n        useCompressTexture: true,\n        presetId: 'd7wPRcBK9EhbrEXzBVG3HR',\n    },\n    // 1 3D貼圖\n    {\n        useCompressTexture: true,\n        presetId: '02g2e6zdBE7byIWrLpKBEv',\n    },\n];\n\nlet sourcePath = process.argv[2];\nlet isCompress = parseInt(process.argv[3]);\n\nlet lookupDir = function (url, bo3D) {\n    if (!fs.existsSync(url)) {\n        return;\n    }\n    fs.readdir(url, (err, files) => {\n        if (err) {\n            console.error(err);\n            return;\n        }\n        files.forEach((file) => {\n            let curPath = path.join(url, file);\n            let stat = fs.statSync(curPath);\n            if (stat.isDirectory()) {\n                let pathHas3D =\n                    bo3D || curPath.indexOf('3D') >= 0 || curPath.indexOf('FBX') >= 0 || curPath.indexOf('GLTF') >= 0;\n                lookupDir(curPath, pathHas3D); // 找尋所有目錄\n            } else {\n                if (file.indexOf('.meta') >= 0) {\n                    fs.readFile(curPath, (err, data) => {\n                        if (err) {\n                            console.error(err);\n                            return;\n                        }\n                        let obj = JSON.parse(data);\n                        if (obj && obj.importer && obj.importer === 'image' && obj.userData) {\n                            let wrdata;\n\n                            obj.userData.compressSettings = _compressSettings[bo3D ? 1 : 0]; // 設定壓縮材質\n                            wrdata = JSON.stringify(obj, null, 2);\n\n                            //                            if (obj.userData.compressSettings) {\n                            //                                obj.userData.compressSettings = undefined;\t\t\t\t\t\t\t\t// 清除壓縮材質\n                            //                                wrdata = JSON.stringify(obj, null, 2);\n                            //                            }\n\n                            if (wrdata) {\n                                fs.writeFile(curPath, wrdata, (err) => {\n                                    if (err) {\n                                        console.error(err);\n                                        return;\n                                    } else {\n                                        console.log(curPath + ' success!!');\n                                    }\n                                });\n                            }\n                        }\n                    });\n                }\n            }\n        });\n    });\n};\n\nif (!path.isAbsolute(sourcePath)) {\n    sourcePath = path.join(__dirname, sourcePath);\n}\nlookupDir(sourcePath);\n"]}
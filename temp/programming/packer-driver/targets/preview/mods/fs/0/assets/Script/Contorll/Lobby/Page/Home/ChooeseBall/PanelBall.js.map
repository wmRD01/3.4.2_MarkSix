{"version":3,"sources":["file:///C:/CocosProject/3.4.2_MarkSix/assets/Script/Contorll/Lobby/Page/Home/ChooeseBall/PanelBall.ts"],"names":["instantiate","Layout","Node","Prefab","_decorator","DelayTime","AssetType","LobbyStateEvent","AssetMng","ButtonMng","BallData","BaseComponent","ccclass","property","PanelBall","Map","onLoad","startLoad","start","waitStateCheck","Sprite","labelContent","removeAllChildren","HorLayout","isEnd","V","Valign","layout","layoutItem","addChild","H","Halign","count","_node","ballItem","_class","getComponent","mapBallNumber","set","init","cancel","addEvent","button","toString","label","node","getInstance","StartDT","index","children","length","enabled","onRandomNumber","e","customEventData","onResetChooese","arr","MaxCount","random","Math","floor","totalCount","indexOf","onChooeseBall","push","isConfirm","convert","Number","tempChoose","isChoose","get","choose","onConfirmAttack","console","log","len","shift","sort","eventEmit","BallChooeseAction","reProcessing"],"mappings":"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","sourcesContent":["import { Button, color, EventTouch, instantiate, Label, Layout, Node, Prefab, random, Sprite, Vec3, _decorator } from 'cc';\r\nimport DelayTime from '../../../../../../Plug/DelayTime';\r\nimport { AssetType } from '../../../../../Enum/AssetType';\r\nimport { LobbyStateEvent } from '../../../../../Enum/LobbyStateEvent';\r\nimport AssetMng from '../../../../../Manager/AssetMng';\r\nimport ButtonMng from '../../../../../Manager/ButtonMng';\r\nimport BallData from '../../../../../Model/BallData';\r\nimport BaseComponent from '../../../../../Model/ComponentBase';\r\nconst { ccclass, property } = _decorator;\r\n@ccclass('PanelBall')\r\nexport default class PanelBall extends BaseComponent {\r\n    @property(Node)\r\n    HorLayout: Node;\r\n    @property(Node)\r\n    labelContent: Node;\r\n    @property(Prefab)\r\n    layoutItem: Prefab;\r\n    @property(Prefab)\r\n    ballItem: Prefab;\r\n    Halign: number = 10;\r\n    Valign: number = 5;\r\n    totalCount: number = 49\r\n    mapBallNumber: Map<number, BallData> = new Map()\r\n\r\n    isChoose: number[] = []\r\n    tempChoose: number[] = []\r\n    /**選擇球數最大值 */\r\n    MaxCount: number = 6\r\n    isConfirm: boolean;\r\n\r\n\r\n    async onLoad() {\r\n        super.onLoad()\r\n        AssetMng.startLoad()\r\n\r\n    }\r\n    async start() {\r\n        await AssetMng.waitStateCheck(AssetType.Sprite)\r\n        this.labelContent.removeAllChildren()\r\n        this.HorLayout.removeAllChildren()\r\n        let isEnd = false\r\n        for (let V = 0; V < this.Valign; V++) {\r\n            let layout = instantiate(this.layoutItem)\r\n            this.HorLayout.addChild(layout)\r\n            for (let H = 1; H <= this.Halign; H++) {\r\n                let count = (V * this.Halign) + H\r\n                if (count > 49) {\r\n                    isEnd = true\r\n                    break;\r\n                }\r\n                let _node = instantiate(this.ballItem)\r\n                let _class = _node.getComponent(BallData)\r\n                this.mapBallNumber.set(count, _class)\r\n                layout.addChild(_node)\r\n                _class.init(count).cancel()\r\n                ButtonMng.addEvent(this, \"onChooeseBall\", _class.button, count.toString())\r\n                this.labelContent.addChild(_class.label.node)\r\n            }\r\n\r\n        }\r\n        await DelayTime.getInstance.StartDT(.016)\r\n        for (let index = 0; index < this.HorLayout.children.length; index++) {\r\n            //球往上飛所以不能讓他自動排版\r\n            this.HorLayout.children[index].getComponent(Layout).enabled = false\r\n        }\r\n    }\r\n    onRandomNumber(e: EventTouch, customEventData?: string) {\r\n        this.onResetChooese(null)\r\n        let arr = []\r\n        while (arr.length < this.MaxCount) {\r\n            let random = 1 + Math.floor((Math.random() * (this.totalCount)))\r\n            if (arr.indexOf(random) == -1) {\r\n                this.onChooeseBall(null, random.toString())\r\n                arr.push(random)\r\n            }\r\n        }\r\n    }\r\n    onChooeseBall(e: EventTouch, customEventData?: string) {\r\n        if (this.isConfirm) return\r\n        let convert = Number(customEventData)\r\n        if ((this.tempChoose.indexOf(convert) > -1 || this.isChoose.indexOf(convert) > -1) || this.tempChoose.length + this.isChoose.length >= this.MaxCount) return\r\n        this.tempChoose.push(convert)\r\n        this.mapBallNumber.get(convert).choose()\r\n    }\r\n    onResetChooese(e: EventTouch, customEventData?: string) {\r\n        if (this.isConfirm) return\r\n        for (let index = 0; index < this.tempChoose.length; index++) {\r\n            this.mapBallNumber.get(this.tempChoose[index]).cancel()\r\n        }\r\n        this.tempChoose = []\r\n    }\r\n    async onConfirmAttack(e: EventTouch, customEventData?: string) {\r\n        if (this.isConfirm) return\r\n        if (this.tempChoose.length < this.MaxCount) {\r\n            return\r\n        }\r\n        console.log(this.tempChoose);\r\n        let len = this.tempChoose.length\r\n        for (let index = 0; index < len; index++) {\r\n            this.isChoose.push(this.tempChoose.shift())\r\n        }\r\n        this.isChoose.sort()\r\n        console.log(this.isChoose);\r\n\r\n        for (let index = 0; index < this.isChoose.length; index++) {\r\n            this.eventEmit(LobbyStateEvent.BallChooeseAction, this.mapBallNumber.get(this.isChoose[index]).node, index)\r\n            await DelayTime.getInstance.StartDT(.1);\r\n        }\r\n        this.tempChoose = []\r\n\r\n        this.isConfirm = true\r\n        /**推波訊息 */\r\n    }\r\n    reProcessing() {\r\n\r\n    }\r\n}\r\n"]}
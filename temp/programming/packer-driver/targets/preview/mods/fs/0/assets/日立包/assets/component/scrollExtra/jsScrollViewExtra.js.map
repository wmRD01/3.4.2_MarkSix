{"version":3,"sources":["file:///C:/CocosProject/3.4.2_MarkSix/assets/%E6%97%A5%E7%AB%8B%E5%8C%85/assets/component/scrollExtra/jsScrollViewExtra.js"],"names":["ListViewNew","require","cc","Class","extends","Component","properties","scrollView","ScrollView","listViewExtra","onLoad","nowOffsetY","selectChildren","selectChildIndex","init","data","i","time","push","_listData","listData","unshift","addScrollChildIndex","newEventHandler","target","component","handler","e","EventHandler","node","off","Node","EventType","MOUSE_WHEEL","scroll","on","scrolling","scrollToOffset","getScrollOffset","y","updateData","updateListSelectChildren","setSelectChildIndex","height","itemHeight","index","itemList","forEach","itemNode","jsItem","getComponent","itemPos","getPositionInView","absY","Math","abs","labNum","string","scale","opacity","getScrollChildOffset","maxoffset","getMaxScrollOffset","offset","o","o2","idx","length","console","log","contentY","sudo","content","stopAutoScroll","scrollOffset","v2","x"],"mappings":"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","sourcesContent":["/* jshint esversion:6 */\n/**\n * 2022/9/15\n * Created by yyg\n */\n\nlet ListViewNew = require(\"ListViewNew\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        scrollView: cc.ScrollView,\n        listViewExtra: ListViewNew,\n    },\n    \n    onLoad () {\n        this.nowOffsetY = 0;\n        this.selectChildren = [];\n        this.selectChildIndex = 0;\n        this.listViewExtra.init([], this);\n\n        let data = [];\n        for (let i = 0; i < 30; i++) {\n            let time = '2022/'+i;\n            data.push(time);\n        }\n        this.init(data);\n    },\n\n    init (_listData) {\n        this.listData = _listData;\n        this.listData.unshift(\" \");\n        this.listData.unshift(\" \");\n        this.listData.push(\" \");\n        this.listData.push(\" \");\n        // 初始化\n        this.addScrollChildIndex();\n    },\n    \n    newEventHandler(target, component, handler) {\n        const e = new cc.Component.EventHandler();\n        e.target = target;\n        e.component = component;\n        e.handler = handler;\n        return e;\n    },\n\n    /** 增加scroll子节点区间功能 */\n    addScrollChildIndex() {\n        /** 禁用鼠标滚轮，滚轮在移动区间时ScrollEvent返回很怪异，没有SCROLL_ENDED事件回调 */\n        this.node.off(cc.Node.EventType.MOUSE_WHEEL);\n        const scroll = this.scrollView;\n        /** scroll事件监听 */\n        scroll.node.on(\"scrolling\", ()=>{\n            this.scrolling(scroll);\n        }, this);\n        scroll.node.on(\"scroll-ended\", ()=>{\n            this.scrollToOffset(scroll);\n        }, this);\n\n        this.nowOffsetY = scroll.getScrollOffset().y;\n\n        /** 加载listView子节点 */\n        this.listViewExtra.updateData(this.listData);\n\n        this.updateListSelectChildren();\n\n        this.setSelectChildIndex(0);\n    },\n\n    // 刷新复用后的item列表\n    updateListSelectChildren(){\n        const height = this.listViewExtra.itemHeight;\n        let index = 0;\n        this.selectChildren = [];\n        this.listViewExtra.itemList.forEach((itemNode, i) => {\n            let jsItem = itemNode.getComponent(\"ListViewItemNew\");\n            let itemPos = this.listViewExtra.getPositionInView(itemNode);\n            let absY = Math.abs(itemPos.y);\n            if(jsItem.labNum.string != \" \"){\n                this.selectChildren[index] = itemNode;\n                itemNode.scale = (600-absY)/600;\n                if(absY <= height/2){\n                    itemNode.opacity = 120 + (height/2-absY)*7;\n                    this.selectChildIndex = index;\n                }else{\n                    itemNode.opacity = 120;\n                }\n                index++;\n            }\n        });\n    },\n\n    getScrollChildOffset(scroll) {\n        this.updateListSelectChildren();\n        /** 每个子节点高度，用来计算区间 */\n        const height = this.listViewExtra.itemHeight;\n        const maxoffset = scroll.getMaxScrollOffset().y;\n        const offset = scroll.getScrollOffset().y;\n        if (offset < 0) {\n            this.selectChildIndex = 0;\n            return 0;\n        } else if (offset > maxoffset) {\n            return maxoffset;\n        }\n        let o = 0;\n        let o2 = height;\n        let i = 0;\n        while(true) {\n            if (Math.abs(o - offset) < Math.abs(o2 - offset)) {\n                return o;\n            }\n            o += height;\n            o2 += height;\n            i ++;\n        }\n    },\n\n    setSelectChildIndex(idx) {\n        for (let i = 0; i < this.selectChildren.length; i++) {\n            this.selectChildren[i].opacity = i == idx ? 255 : 120;\n        }\n        // 这里回调，传出选择结果\n        console.log(\">>> 选择结果:\", idx);\n    },\n\n    scrolling(scroll) {\n        this.updateListSelectChildren();\n        /** 每个子节点高度，用来计算区间 */\n        const maxoffset = scroll.getMaxScrollOffset().y;\n        const offset = scroll.getScrollOffset().y;\n\n        /** 惯性速度低于X后停止滚动 */\n        if(this.contentY){\n            let sudo = scroll.content.y-this.contentY;\n            if(Math.abs(sudo) <= 5){\n                scroll.stopAutoScroll();\n            }\n        }\n        this.contentY = scroll.content.y;\n        \n        if (offset <= 0) {\n            this.selectChildIndex = 0;\n            return;\n        } else if (offset >= maxoffset) {\n            return;\n        }\n    },\n\n    scrollToOffset(scroll) {\n        const offset = this.getScrollChildOffset(scroll);\n        const scrollOffset =  scroll.getScrollOffset();\n        if (Math.abs(this.nowOffsetY - scrollOffset.y) < 0.01) \n            return this.setSelectChildIndex(this.selectChildIndex);\n        this.nowOffsetY = offset;\n        scroll.scrollToOffset(cc.v2(scrollOffset.x,this.nowOffsetY), 0.5);\n    },\n});\n"]}